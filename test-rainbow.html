<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VimCraft - JSX Rainbow Test        }
        
        // Test hover manually
        function testHover() {
            console.log('=== Manual Hover Test ===');
            const braces = document.querySelectorAll('.token.punctuation');
            
            braces.forEach((brace, index) => {
                const text = brace.textContent.trim();
                if (['(', ')', '[', ']', '{', '}'].includes(text)) {
                    console.log(`Testing brace ${index}: "${text}" (ID: ${brace.id})`);
                    
                    // Simulate hover
                    brace.dispatchEvent(new MouseEvent('mouseenter', { bubbles: true }));
                    
                    setTimeout(() => {
                        brace.dispatchEvent(new MouseEvent('mouseleave', { bubbles: true }));
                    }, 2000);
                    
                    break; // Test only the first one
                }
            });
        }
        
        // Make functions available globally
        window.inspectTokens = inspectTokens;
        window.testBraceMatching = testBraceMatching;
        window.testHover = testHover;le>
    <link rel="stylesheet" href="css/gruvbox-styles.css">
    <link rel="stylesheet" href="vendor/prism/themes/prism-tomorrow.css">
    <link rel="stylesheet" href="vendor/prism/themes/prism-match-braces.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>VimCraft - JSX Rainbow Test</h1>
            <p>Testing JSX tag colors with rainbow brackets</p>
        </div>

        <div class="input-section">
            <div style="display: none;">
                <select id="language-select">
                    <option value="jsx">JSX</option>
                </select>
                <select id="mode-select">
                    <option value="normal">Normal</option>
                </select>
            </div>
            <textarea id="source-code" rows="15" style="width: 100%; font-family: 'Courier New', monospace;">// Test JSX with rainbow brackets
function App({ title }) {
  const [count, setCount] = useState(0);
  const data = { items: [1, 2, 3], config: { theme: "dark" } };
  
  return (
    <div className="app">
      <h1>{title}</h1>
      <div className="content">
        <p>Count: {count}</p>
        <button onClick={() => setCount(count + 1)}>
          Increment ({count})
        </button>
        <ul>
          {data.items.map((item, index) => (
            <li key={index}>Item {item}</li>
          ))}
        </ul>
      </div>
    </div>
  );
}</textarea>
            <br><br>
            <button id="convert-btn">Convert</button>
            <button id="test-selection">Test Selection</button>
            <button onclick="testBraceMatching()">Debug Braces</button>
            <button onclick="testHover()">Test Hover</button>
        </div>

        <div class="results-section">
            <h3>VimCraft Output:</h3>
            <div class="output-container">
                <pre class="rainbow-braces" data-prism-match-braces data-prism-brace-hover data-prism-brace-select>
                    <code id="preview-output" class="language-jsx"></code>
                </pre>
            </div>
            <div style="display: none;">
                <pre><code id="source-output"></code></pre>
            </div>
        </div>
    </div>

    <script src="vendor/prism/prism-core.js"></script>
    <script src="vendor/prism/components/prism-typescript.js"></script>
    <script src="vendor/prism/components/prism-jsx.js"></script>
    <script src="vendor/prism/components/prism-tsx.js"></script>
    <script src="vendor/prism/plugins/prism-match-braces.js"></script>
    
    <!-- Load the main application as an ES module -->
    <script type="module" src="js/neovim-handler.js"></script>
    
    <script>
        // Token inspection helper
        function inspectTokens() {
            const output = document.querySelector('#preview-output');
            if (!output) {
                console.log('No output found');
                return;
            }
            
            const tokens = output.querySelectorAll('span');
            console.log('=== Token Inspection ===');
            
            tokens.forEach((token, index) => {
                const text = token.textContent.trim();
                const classes = Array.from(token.classList);
                
                // Focus on JSX tags and brackets
                if (text === '<' || text === '>' || text === '{' || text === '}' || text === '(' || text === ')' || text === '[' || text === ']') {
                    console.log(`Token ${index}: "${text}" - Classes: ${classes.join(', ')}`);
                    
                    // Check computed styles
                    const computedStyle = window.getComputedStyle(token);
                    console.log(`  Color: ${computedStyle.color}`);
                }
            });
            
            // Check specifically for JSX tag tokens
            const tagTokens = output.querySelectorAll('.token.tag, .token.tag .token.punctuation, .token.punctuation.tag');
            console.log('=== JSX Tag Tokens ===');
            tagTokens.forEach((token, index) => {
                const computedStyle = window.getComputedStyle(token);
                console.log(`Tag token ${index}: "${token.textContent}" - Classes: ${Array.from(token.classList).join(', ')} - Color: ${computedStyle.color}`);
            });
        }
        
        // Test brace matching functionality
        function testBraceMatching() {
            console.log('=== Testing Brace Matching ===');
            console.log('Prism object:', window.Prism);
            console.log('Prism hooks:', window.Prism?.hooks);
            console.log('Prism plugins:', window.Prism?.plugins);
            
            const output = document.querySelector('#preview-output');
            if (!output) {
                console.log('No output found');
                return;
            }
            
            const preElement = output.parentElement;
            console.log('Pre element:', preElement);
            console.log('Pre element classes:', preElement?.classList);
            console.log('Pre element attributes:', preElement?.attributes);
            
            // Find brace tokens
            const braceTokens = output.querySelectorAll('.token.punctuation');
            console.log(`Found ${braceTokens.length} punctuation tokens`);
            
            braceTokens.forEach((token, index) => {
                const text = token.textContent.trim();
                const classes = Array.from(token.classList);
                if (['(', ')', '[', ']', '{', '}'].includes(text)) {
                    console.log(`Brace ${index}: "${text}" - Classes: ${classes.join(', ')} - ID: ${token.id}`);
                    
                    // Check if it has event listeners
                    const events = getEventListeners ? getEventListeners(token) : 'getEventListeners not available';
                    console.log('Event listeners:', events);
                }
            });
            
            // Test if we can manually trigger the plugin
            if (window.Prism && window.Prism.hooks) {
                console.log('Manually triggering Prism complete hook...');
                const event = {
                    element: output,
                    language: 'jsx',
                    grammar: window.Prism.languages.jsx || window.Prism.languages.javascript,
                    code: output.textContent
                };
                window.Prism.hooks.run('complete', event);
            }
        }
        
        // Wait for the NeovimHandler to be initialized, then auto-convert
        document.addEventListener('DOMContentLoaded', function() {
            // Wait a bit for the module to load and initialize
            setTimeout(() => {
                const convertBtn = document.getElementById('convert-btn');
                const testSelectionBtn = document.getElementById('test-selection');
                
                if (convertBtn) {
                    // Auto-convert on load
                    convertBtn.click();
                    
                    // Set up test selection button
                    if (testSelectionBtn) {
                        testSelectionBtn.addEventListener('click', function() {
                            const textarea = document.getElementById('source-code');
                            textarea.setSelectionRange(150, 200); // Select part of the JSX
                            convertBtn.click();
                        });
                    }
                }
            }, 1000);
        });
        
        // Make inspectTokens and testBraceMatching available globally
        window.inspectTokens = inspectTokens;
        window.testBraceMatching = testBraceMatching;
    </script>
</body>
</html>
