<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vim Craft- Interactive Mode Converter</title>
    <link rel="stylesheet" href="./css/gruvbox-styles.css" />
    <link rel="stylesheet" href="./vendor/prism/themes/prism-match-braces.css" />
    <style>
      #debug-log {
        position: fixed;
        top: 10px;
        right: 10px;
        width: 400px;
        height: 300px;
        background: #1d2021;
        color: #ebdbb2;
        border: 1px solid #458588;
        padding: 10px;
        font-family: monospace;
        font-size: 12px;
        overflow-y: auto;
        z-index: 1000;
      }
      #debug-log h3 {
        margin: 0 0 10px 0;
        color: #fabd2f;
      }
      .log-entry {
        margin-bottom: 5px;
        padding: 2px;
        border-left: 3px solid #458588;
        padding-left: 5px;
      }
      .log-error {
        border-left-color: #fb4934;
        background: rgba(251, 73, 52, 0.1);
      }
      .log-warn {
        border-left-color: #fabd2f;
        background: rgba(250, 189, 47, 0.1);
      }
      .log-info {
        border-left-color: #83a598;
        background: rgba(131, 165, 152, 0.1);
      }
    </style>
  </head>
  <body>
    <!-- Debug Log Panel -->
    <div id="debug-log">
      <h3>Debug Log</h3>
      <div id="log-content"></div>
    </div>

    <div class="container">
      <h1>ðŸŽ¨ VimCraft - Interactive Mode Converter - (anki)</h1>

      <!-- Form Section -->
      <div class="form-section">
        <div class="form-group">
          <label for="language-select">Language:</label>
          <select id="language-select" class="form-control">
            <option value="html">HTML</option>
            <option value="javascript">JavaScript</option>
            <option value="typescript" selected>TypeScript</option>
            <option value="python">Python</option>
            <option value="java">Java</option>
            <option value="swift">Swift</option>
            <option value="css">CSS</option>
          </select>
        </div>

        <div class="form-group">
          <label for="mode-select">Vim Mode:</label>
          <select id="mode-select" class="form-control">
            <option value="normal">Normal</option>
            <option value="insert">Insert</option>
            <option value="visual">Visual</option>
          </select>
        </div>

        <div class="form-group">
          <label for="source-code">Source Code:</label>
          <textarea
            id="source-code"
            class="form-control"
            rows="10"
            placeholder="Enter your source code here...">// Test JSX/HTML tag coloring with rainbow brackets

function TestComponent(props) {
  const [state, setState] = useState(0);
  
  return (
    <div className="container">
      <h1>Title</h1>
      <p>Text with {variable} and (parentheses) and [arrays] and {objects}</p>
      <button onClick={() => handleClick(state, [1, 2, 3])}>
        Click me
      </button>
    </div>
  );
}</textarea>
          <div class="selection-info">
            <span id="selection-text">No text selected</span>
          </div>
        </div>

        <button id="clean-btn" class="convert-button" style="background: var(--gray); margin-right: 10px;">Clear</button>
        <button id="convert-btn" class="convert-button">Convert</button>
      </div>

      <!-- Results Section -->
      <div class="results-section">
        <div class="result-panel">
          <div class="panel-header">
            Preview
            <button id="copy-preview-btn" class="copy-button">Copy</button>
          </div>
          <div class="editor-panel">
            <pre class="rainbow-braces" data-prism-match-braces data-prism-brace-hover data-prism-brace-select>
              <code class="code-block" id="preview-output">
                <div class="placeholder">Your converted code will appear here...</div>
              </code>
            </pre>
            <div class="status-bar" id="status-bar">-- NORMAL --</div>
          </div>
        </div>

        <div class="result-panel">
          <div class="panel-header">
            Source Code
            <button id="copy-btn" class="copy-button">Copy</button>
          </div>
          <div class="source-panel">
            <pre id="source-output"><code>Your HTML source code will appear here...</code></pre>
          </div>
        </div>
      </div>
    </div>

    <!-- Debug Logger Script -->
    <script>
      // Create debug logger
      const debugLog = document.getElementById('log-content');
      
      function addLog(message, type = 'info') {
        const entry = document.createElement('div');
        entry.className = `log-entry log-${type}`;
        entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        debugLog.appendChild(entry);
        debugLog.scrollTop = debugLog.scrollHeight;
        
        // Keep only last 50 entries
        while (debugLog.children.length > 50) {
          debugLog.removeChild(debugLog.firstChild);
        }
      }
      
      // Override console methods
      const originalConsole = {
        log: console.log,
        error: console.error,
        warn: console.warn,
        info: console.info
      };
      
      console.log = function(...args) {
        originalConsole.log.apply(console, args);
        addLog(args.join(' '), 'info');
      };
      
      console.error = function(...args) {
        originalConsole.error.apply(console, args);
        addLog(args.join(' '), 'error');
      };
      
      console.warn = function(...args) {
        originalConsole.warn.apply(console, args);
        addLog(args.join(' '), 'warn');
      };
      
      console.info = function(...args) {
        originalConsole.info.apply(console, args);
        addLog(args.join(' '), 'info');
      };
      
      // Catch unhandled errors
      window.addEventListener('error', function(e) {
        addLog(`ERROR: ${e.message} at ${e.filename}:${e.lineno}`, 'error');
      });
      
      window.addEventListener('unhandledrejection', function(e) {
        addLog(`UNHANDLED PROMISE REJECTION: ${e.reason}`, 'error');
      });
      
      addLog('Debug logger initialized', 'info');
      
      // Add Clean button functionality
      document.addEventListener('DOMContentLoaded', function() {
        const cleanBtn = document.getElementById('clean-btn');
        const sourceCodeTextarea = document.getElementById('source-code');
        
        if (cleanBtn && sourceCodeTextarea) {
          cleanBtn.addEventListener('click', function() {
            sourceCodeTextarea.value = '';
            sourceCodeTextarea.focus();
            addLog('Source code cleared', 'info');
          });
        }
      });
    </script>

    <!-- Load the main application as an ES module -->
    <script type="module" src="./js/neovim-handler.js"></script>
  </body>
</html>
